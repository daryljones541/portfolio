function loadCalendar(){scrollbar=0;monthYear=new Date;month=monthYear.getMonth();year=monthYear.getFullYear();day=monthYear.getDate();fetchMonth();$("#event-box").on("click","img",function(){$("#event-box").hide()});$("#event-box").on("click",".delete-event",function(){var n=$(this).attr("id").substr(5);$.ajax({type:"post",url:"/Home/DeleteEvent",data:{id:n},success:function(t){if(t=="deleted"){var i=$("#span"+n).index();$("#span"+n).remove();i==1&&$("#event-box hr").length>0&&$("#event-box hr").first().remove();$("#event-box span").length==0&&$("#event-box").hide();fetchMonth()}}})});$("#event-box").on("click",".edit-event",function(){var c=$(this).attr("id").substr(5),n=$(this).parent().parent().text(),i=n.indexOf("at"),r=n.indexOf("Location"),u,f,t,e,o,s,h;if(i==-1||i>r){if(u=n.indexOf("All"),u!=-1)var f=n.substr(0,u-1)+", "+year,e="All Day",o=n.substr(u+7,r-(u+7))}else f=n.substr(0,i-1)+", "+year,t=n.indexOf("AM"),t==-1&&(t=n.indexOf("PM")),e=n.substr(i+3,t-(i+1)),o=n.substr(t+2,r-(t+2));s=n.substr(r+10,n.length-(r+20));$("#addEditTitle").html("Edit Event");$("#editEventId").val(c);jDate=new Date(f);$("#eventDatePicker").datepicker("setDate",jDate);h=$("#timeDropDown option:contains("+e+")").val();$("#timeDropDown").val(h);$("#location").val(s);$("#title").val(o);$("#event-box").hide();$("#modal-addevent").modal("show")})}function fetchMonth(){scrollbar=$(window).scrollTop();$.ajax({type:"post",url:"/Home/GetList",data:{month:month,year:year},dataType:"json",success:function(n){var t,i;for(numEvents=n.length,t=0;t<numEvents;t++)i=new Date(parseInt(n[t].Date.replace("/Date(",""))),n[t].Date=i;calendar(n)}})}function daysInMonth(){var n=[31,28,31,30,31,30,31,31,30,31,30,31];return year%4==0&&(year%100!=0||year%400==0)&&(n[1]=29),n[month]}function calendar(n){var v=["January","February","March","April","May","June","July","August","September","October","November","December"],r='<table id="events"><thead><tr><th id="calendar-title" colspan="7"><img src="/Images/120px-Arrow_left.svg.png"  alt="Back one month" title="Back one month" id="left-arrow" /> '+v[month]+" "+year+' <img src="/Images/120px-Arrow_right.svg.png" alt="Forward one month" title="Forward one month" id="right-arrow" /><\/th><\/tr><tr id="weekdays"><th>Sun<\/th><th>Mon<\/th><th>Tue<\/th><th>Wed<\/th><th>Thu<\/th><th>Fri<\/th><th>Sat<\/th><\/tr><\/thead>',h=new Date(year,month,1),u=h.getDay(),y,i,c,f,o,p,l,s,e,a,w,b,t,k;if(u>0)for(r+="<tbody><tr>",i=0;i<u;i++)r+="<td><\/td>";for(y=daysInMonth(monthYear),i=1;i<=y;i++){for(h.setDate(i),u=h.getDay(),i==1&&u==0&&(r+="<tbody>"),u==0&&(r+="<tr>"),c='<td class="calendar-box">'+i+"<br />",f="",t=0;t<n.length;t++)o=new Date(n[t].Date),o.getDate()==i&&(p=t>0&&f!=""?"<hr />":"",n[t].AllDay==!1?(l=" AM",s=o.getHours(),s>12&&(s-=12,l=" PM"),e=o.getMinutes(),e<10&&(e="0"+e),a=" at "+s+":"+e+l):a=" All Day",w=n[t].Title,b=v[month]+" "+i+a+"\n"+w+"\nLocation: "+n[t].Location,f+="<span id=&quot;span"+n[t].ID+"&quot>"+p+b+"<div class=&quot;event-buttons&quot;><button id=&quot;event"+n[t].ID+"&quot; class=&quot;delete-event&quot;>Delete<\/button><button id=&quot;event"+n[t].ID+"&quot; class=&quot;edit-event&quot;>Edit<\/button><\/div><\/span>");f!=""&&(c='<td class="calendar-box display-event" id="'+f+'">'+i);r+=c+"<\/td>";u==6&&(r+="<\/tr>")}if(u<6)for(t=u;t<6;t++)r+="<td><\/td>";r+="<\/tbody><\/table>";$("#calendar").html(r);k=$("#events td").width();$("#events td").height(k);$(window).scrollTop(scrollbar);$(".display-event").click(function(){var n=$(this).attr("id"),u,f;n=n.replace(/\n/g,"<br />");n='<img id="closer-window" src="/Images/CloseWindow19x19.png" alt="close window" title="Close event window" />'+n;var r=$(this).position(),t=r.left,i=r.top,e=$(this).outerHeight(),o=$(this).outerWidth();$("#event-box").html(n);u=$("#event-box").outerWidth();f=$("#event-box").outerHeight();t+=o/2-u/2;i+=e/2-f/2;t<0&&(t=0);i<0&&(i=0);$("#event-box").css("top",i);$("#event-box").css("left",t);$("#event-box").show()});$("#left-arrow").click(function(){$("#event-box").hide();month--;month<0&&(month=11,year--);monthYear=new Date(year,month,day);fetchMonth();scrollbar=$(window).scrollTop()});$("#right-arrow").click(function(){$("#event-box").hide();month++;month>11&&(month=0,year++);monthYear=new Date(year,month,day);fetchMonth()})}$().ready(function(){loadCalendar()});$(window).resize(function(){var n=$("#events td").width();$("#events td").height(n)});